<!doctype HTML>
<html lang="en">
    <meta charset="utf-8">
    <head>
        <!--<link href="https://src-bin.com/" rel="canonical">-->
        <link href="/css/2022-03-03.css" rel="stylesheet">
        <meta property="og:description" content="A page from the Substrate manual">
        <meta property="og:image" content="https://src-bin.com/img/apple-touch-icon.png">
        <meta property="og:title" content="Source &amp; Binary / Substrate manual / Enumerating all your AWS accounts">
        <meta property="og:type" content="website">
        <meta property="og:url" content="https://src-bin.com/substrate/manual/enumerating-all-your-aws-accounts/">
        <meta name="twitter:card" content="summary">
        <meta name="twitter:description" content="A page from the Substrate manual">
        <meta name="twitter:image" content="https://src-bin.com/img/apple-touch-icon.png">
        <meta name="twitter:site" content="@src_bin">
        <meta name="twitter:title" content="Source &amp; Binary / Substrate manual / Enumerating all your AWS accounts">
        <title>Source &amp; Binary / Enumerating all your AWS accounts</title>
    </head>
    <body>
        <header>
            <h1><a href="/">Source <span class="fancy">&amp;</span> Binary</a></h1>
            <p><a href="mailto:hello@src-bin.com">hello@src-bin.com</a></p>
            <aside>Purveyors&nbsp;of&nbsp;secure,&nbsp;reliable,&nbsp;and&nbsp;compliant&nbsp;cloud&nbsp;infrastructure&nbsp;since&nbsp;2020</aside>
            <nav>
                <ul>
                    <li><a href="/">Benefits</a></li>
                    <li><a href="/substrate/">Features</a></li>
                    <li><a href="/substrate/manual/">Documentation</a></li>
                    <li><a href="/pricing/">Pricing</a></li>
                    <!--<li><a href="/compliance/">Compliance Workshop</a></li>-->
                </ul>
            </nav>
        </header>

        <section>

<h1>Enumerating all your AWS accounts</h1>

<p>Substrate 2021.08 added <code>-format="json"</code> to <code>substrate-accounts</code> which makes it easier to programmatically enumerate all your AWS accounts. You might want to integrate Substrate into your CI/CD system, implement a monitoring function, or something else entirely. The JSON output includes account numbers, ARNs, and tags, which should be enough to parameterize almost anything you might want to do to most or all of your AWS accounts.</p>

<p>The rest of this page considers how to run the appropriate Substrate command against every AWS account in your organization.</p>

<p>The special accounts are singletons and thus don&rsquo;t need to be parameterized by the output of <code>substrate-accounts</code>:</p>

<pre><code>substrate-bootstrap-management-account

substrate-bootstrap-network-account # possibly with -no-nat-gateways

substrate-bootstrap-deploy-account
</code></pre>

<p>But admin accounts and service accounts need to be identified by quality (for admin accounts) or domain, environment, and quality (for service accounts). You can pass these parameters from the output of <code>substrate-accounts</code> to <code>substrate-create-admin-account</code> and <code>substrate-create-account</code> thus:</p>

<pre><code>substrate-accounts -format="json" |
jq -e -r &apos;.[].Tags | select(.Domain == "admin") | "substrate-create-admin-account -quality=\(.Quality)"&apos; |
sh -e -x

substrate-accounts -format="json" |
jq -e -r &apos;.[].Tags | select(.Domain and .Domain != "admin") | "substrate-create-account -domain=\(.Domain) -environment=\(.Environment) -quality=\(.Quality)"&apos; |
sh -e -x
</code></pre>

<p>You can process this JSON ahead of time to e.g. generate CI/CD configuration files or at runtime to e.g. propagate a Substrate upgrade to all your AWS accounts. No matter what, it&apos;s a small matter of programming.</p>

<p>If your use-case is more straightforward and you just need the shell commands necessary to touch every one of your Substrate-managed AWS accounts, use <code>substrate-accounts -format="shell"</code> (added in Substrate 2021.09).</p>

<pre><code>substrate-accounts -format="shell" | sh -e -x
</code></pre>

<p>This will accomplish the same thing as the series of commands constructed above.</p>

        </section>

        <footer>
            <p class="fine-print">&copy; 2020-2022 &mdash; Source <span class="fancy">&amp;</span> Binary&nbsp;LLC</p>
        </footer>
    </body>
</html>
