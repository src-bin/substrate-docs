<!doctype HTML>
<html lang="en">
<meta charset="utf-8">
<head>
<link href="/css/2019-11-01.css" rel="stylesheet">
<title>Source &amp; Binary / Removing an AWS region</title>
</head>
<body>
<header><h1><a href="/">Source <span class="fancy">&amp;</span> Binary</a></h1></header>

<h1>Removing an AWS region</h1>

<p>You may at some point decide you want to abandon an AWS region you&rsquo;re using. Perhaps your traffic has shifted, perhaps your architecture&rsquo;s changed, or perhaps it&rsquo;s for some other reason. No matter, here&rsquo;s how you remove a region from Substrate&rsquo;s management and your root Terraform modules.</p>

<h2>Ensure service continuity and data durability</h2>

<p>First and foremost, if you&rsquo;re going to remove a region and all the infrastructure there, ensure you&rsquo;re not going to cause an outage or data loss when you do. Ensure that services will continue to operate, either by having sufficient capacity elsewhere or by proactively draining traffic from the region that&rsquo;s about to be removed. Ensure any data stored in the region is available in at least one but preferably two other regions.</p>

<h2>Remove the region from Substrate</h2>

<p>Run <code>substrate-bootstrap-network-account</code> and edit remove the region from your list of regions. After it completes its run you&rsquo;ll have a great many directories in <code>root-modules</code> that reference the region which will no longer be managed by any Substrate tools.</p>

<h2>Destroy admin and service infrastructure in the region</h2>

<p><code>find root-modules -name <em>region</em></code> to list all the root modules that run in the region. Starting with your service accounts, run <code>terraform destroy</code> in each one and then <code>rm -f -r</code> that directory.</p>

<h2>Destroy network peering relationships</h2>

<p><code>find root-modules/network/peering -name <em>region</em></code> to list all the root modules that manage network peering relationships that involve the region. Run <code>terraform destroy</code> and <code>rm -f -r</code> for each one, just as you did for service accounts before.</p>

<h2>Destroy deploy buckets and the networks themselves</h2>

<p><code>find root-modules -name <em>region</em></code> again and run <code>terraform destroy</code> and <code>rm -f -r</code> for everything that&rsquo;s left. It&rsquo;s likely that you&rsquo;ll have to destroy the networks twice to fully resolve Terraform&rsquo;s dependencies.</p>

<footer>
<ul>
<li><a href="/services/">Services</a>: <small>infrastructure, architecture, compliance</small></li>
<li><a href="/substrate/">Substrate</a>, <small>my suite of AWS management tools</small></li>
</ul>
<p>Copyright &copy; 2020-2021 &mdash; Source <span class="fancy">&amp;</span> Binary LLC</p>
</footer>
</body>
</html>
