<!doctype HTML>
<html lang="en">
    <head>
        <link href="/css/2022-08-29.css" rel="stylesheet">
        <meta charset="utf-8">
        <meta content="summary" name="twitter:card">
        <meta content="A page from the Substrate manual" name="twitter:description">
        <meta content="https://src-bin.com/img/apple-touch-icon.png" name="twitter:image">
        <meta content="@src_bin" name="twitter:site">
        <meta content="Source &amp; Binary / Substrate manual / Auditing your Substrate-managed AWS organization" name="twitter:title">
        <meta content="width=device-width,initial-scale=1" name="viewport">
        <meta content="A page from the Substrate manual" property="og:description">
        <meta content="https://src-bin.com/img/apple-touch-icon.png" property="og:image">
        <meta content="Source &amp; Binary / Substrate manual / Auditing your Substrate-managed AWS organization" property="og:title">
        <meta content="website" property="og:type">
        <meta content="https://src-bin.com/substrate/manual/auditing/" property="og:url">
        <title>Source &amp; Binary / Auditing your Substrate-managed AWS organization</title>
    </head>
    <body>
        <header>
            <h1><a href="/">Source <span class="fancy">&amp;</span> Binary</a></h1>
            <p><a href="mailto:hello@src-bin.com">hello@src-bin.com</a></p>
            <aside>Purveyors&nbsp;of&nbsp;secure,&nbsp;reliable,&nbsp;and&nbsp;compliant&nbsp;cloud&nbsp;infrastructure&nbsp;since&nbsp;2020</aside>
            <nav>
                <ul>
                    <li><a href="/substrate/">Substrate</a></li>
                    <li><a href="/substrate/manual/">Documentation</a></li>
                    <li><a href="/substrate/pricing/">Pricing</a></li>
                    <!--<li><a href="/compliance/">Compliance Workshop</a></li>-->
                </ul>
            </nav>
        </header>

        <section>

<h1>Auditing your Substrate-managed AWS organization</h1>

<p>One of the very first things Substrate does is to configure AWS CloudTrail with a single trail that covers all organization accounts in all regions. To access this wealth of data, assume the <code>Auditor</code> role in your audit&nbsp;account.</p>

<p>On the command line: <code>substrate assume-role -special audit</code></p>

<p>Or you can assume the role in the AWS Console via your Intranet&rsquo;s Accounts&nbsp;page.</p>

<p>In either case, the data you seek is in the <code><em>prefix</em>-cloudtrail</code> (substituting your chosen prefix as stored in <code>substrate.prefix</code>) S3 bucket. You can download it to analyze locally or <a href="https://docs.aws.amazon.com/athena/latest/ug/cloudtrail-logs.html">query it with Amazon Athena</a>. The most straightforward way to proceed is by creating Athena tables for each AWS account; partition projection to cover the entire organization is&nbsp;unsolved.</p>

<h2>Allowing third parties to audit your Substrate-managed AWS organization</h2>

<p>Many tools have grown the ability to assume an IAM role in your AWS account to perform some auditing or monitoring feature on your behalf. To allow these into your AWS organization, create an assume role policy in <code>substrate.Auditor.assume-role-policy.json</code> with contents like&nbsp;this:</p>

<pre><code>{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Principal": {
        "AWS": [
          "arn:aws:iam::ACCOUNT_NUMBER:role/ROLE_NAME"
        ]
      },
      "Action": "sts:AssumeRole"
    }
  ]
}
</code></pre>

<p>You can include as many principals as you&rsquo;d like in the innermost&nbsp;list.</p>

<p>Every time you update this file, you&rsquo;ll need to re-run whichever of <code>substrate bootstrap-management-account</code>, <code>substrate bootstrap-deploy-account</code>, <code>substrate bootstrap-network-account</code>, <code>substrate create-admin-account</code> (for each of your admin accounts), and/or <code>substrate create-account</code> (for each of your service accounts) are relevant to your&nbsp;situation.</p>

<p>This will authorize third-party principals to <code>sts:AssumeRole</code> using the ARN of one of your Auditor roles and operate as you would&nbsp;there.</p>

<p>Note, too, that this pattern can be applied to the Administrator role using the <code>substrate.Administrator.assume-role-policy.json</code> file per <a href="../adding-administrators/">adding administrators to your AWS organization</a>.</p>

        </section>

        <footer>
            <p class="fine-print">&copy; 2020-2022 &mdash; Source <span class="fancy">&amp;</span> Binary&nbsp;LLC</p>
        </footer>
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-T1M8F1RWMC"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', 'G-T1M8F1RWMC');
        </script>
    </body>
</html>
