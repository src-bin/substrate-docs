<!doctype HTML>
<html lang="en">
    <head>
        <link href="/css/2022-08-29.css" rel="stylesheet">
        <meta charset="utf-8">
        <meta content="summary" name="twitter:card">
        <meta content="A page from the Substrate manual" name="twitter:description">
        <meta content="https://src-bin.com/img/apple-touch-icon.png" name="twitter:image">
        <meta content="@src_bin" name="twitter:site">
        <meta content="Source &amp; Binary / Substrate manual / Domains, environments, and qualities" name="twitter:title">
        <meta content="width=device-width,initial-scale=1" name="viewport">
        <meta content="A page from the Substrate manual" property="og:description">
        <meta content="https://src-bin.com/img/apple-touch-icon.png" property="og:image">
        <meta content="Source &amp; Binary / Substrate manual / Domains, environments, and qualities" property="og:title">
        <meta content="website" property="og:type">
        <meta content="https://src-bin.com/substrate/manual/domains-environments-qualities/" property="og:url">
        <title>Source &amp; Binary / Domains, environments, and qualities</title>
    </head>
    <body>
        <header>
            <h1><a href="/">Source <span class="fancy">&amp;</span> Binary</a></h1>
            <p><a href="mailto:hello@src-bin.com">hello@src-bin.com</a></p>
            <aside>Purveyors&nbsp;of&nbsp;secure,&nbsp;reliable,&nbsp;and&nbsp;compliant&nbsp;cloud&nbsp;infrastructure&nbsp;since&nbsp;2020</aside>
            <nav>
                <ul>
                    <li><a href="/substrate/">Substrate</a></li>
                    <li><a href="/substrate/manual/">Documentation</a></li>
                    <li><a href="/substrate/pricing/">Pricing</a></li>
                    <!--<li><a href="/compliance/">Compliance Workshop</a></li>-->
                </ul>
            </nav>
        </header>

        <section>

<h1>Domains, environments, and qualities</h1>

<p>Substrate leans heavily on three concepts in order to improve the reliability of the overall system by minimizing the blast radius of&nbsp;changes.</p>

<p>They&rsquo;re usually referred to in alphabetical order - domain, environment, and quality - but are presented here in a progression more suitable to readers new to&nbsp;Substrate.</p>

<h2>Environments</h2>

<p>Environments identify a set of data and the infrastructure that stores and processes it. (After all, what distinguishes your production environment from development, staging, or another? Production <em>data</em>; your customers&rsquo; <em>real, business-critical data</em>.) An environment&rsquo;s primary purpose is to protect its data against access from other&nbsp;environments.</p>

<p>Use multiple environments to protect your customers’ data from code that hasn’t been tested thoroughly in pre-production&nbsp;environments.</p>

<p>An AWS account in your organization is a member of exactly one environment and can only access the networks assigned to that&nbsp;environment.</p>

<h3>Examples</h3>

<p>Organizations typically define environments like <em>development</em>, <em>staging</em>, and <em>production</em> though the names and number is entirely up to you. Add more environments to, for example, support more different kinds of testing with greater&nbsp;parallelism.</p>

<h2>Qualities</h2>

<p>Highly reliable services almost always implement changes gradually to give their operators a chance to detect and mitigate failures when the impact is small. Qualities help make gradual change possible for  AWS resources that would otherwise be difficult to incrementally change like load balancers, autoscaling groups, security groups, DNS zones, IAM roles, and more, even within a single&nbsp;service.</p>

<p>Use multiple qualities to protect any one service from changes that affect that whole service&nbsp;immediately.</p>

<p>An AWS account in your organization is associated with exactly one quality but can access and use resources in AWS account of any quality so long as they share the same&nbsp;environment.</p>

<h3>Examples</h3>

<p>Suppose your organization defined the qualities <em>alpha</em>, <em>beta</em>, and <em>gamma</em> (which is one set of qualities that Substrate recommends). You could run 1% of your production environment in your alpha accounts, 9% in your beta accounts, and the remaining 90% in your gamma accounts. This isn&rsquo;t as smooth as routing a slowly increasing percentage of traffic to your new software as it&rsquo;s being deployed (and you should strongly consider doing that, too, eventually) but this strategy works when it&rsquo;s an AWS resource you want to change&nbsp;incrementally.</p>

<p>You could also decide to name your qualities <em>blue</em> and <em>green</em> and swing traffic back and forth between them. The slight disadvantage to this architecture is that the one that&rsquo;s not receiving any traffic is not, at that moment, proving that its configuration is functional and thus the first trickle of traffic that comes to it when you start to swing back to it is slightly higher&nbsp;risk.</p>

<p>Or you could decide name your only quality <em>default</em>. (Most folks using Substrate do this at first.) Later, when you need it, you can add a <em>canary</em> quality that your deploy to first and that takes a small fraction of your traffic. You might also add an <em>enterprise</em> or <em>proven</em> quality that you deploy to last where your highest-paying or most-risk-averse customers are&nbsp;routed.</p>

<h2>Domains</h2>

<p>Domains are groups of one or more software services that form an isolated failure domain (pun very much intended). The software may be that which you&rsquo;ve written yourself, hosted in any serverless or serverful manner, an AWS-managed service, something you bought from the AWS Marketplace, or a SaaS product that manages infrastructure in one of your AWS&nbsp;accounts.</p>

<p>Use multiple domains to protect services in any one domain from changes in all other domains. Group services into a single domain when they&rsquo;re tightly coupled, share the same level of access to AWS or other services, or are developed and deployed&nbsp;together.</p>

<p>An AWS account in your organization is associated with exactly one domain but can access network services in any AWS account that shares its environment. There may be multiple AWS accounts within a domain, each in a different environment or of a different&nbsp;quality.</p>

<h3>Example</h3>

<p>It is intended that every AWS account that shares the same domain also shares the same Terraform codebase. That codebase progresses through environments and qualities as changes are deployed. For example, consider the domain <em>example</em> which exists in the following environments and&nbsp;qualities:</p>

<ul>
<li>Domain: <em>example</em>, Environment: <em>staging</em>, Quality: <em>alpha</em></li>
<li>Domain: <em>example</em>, Environment: <em>production</em>, Quality: <em>beta</em></li>
<li>Domain: <em>example</em>, Environment: <em>production</em>, Quality: <em>gamma</em></li>
</ul>

<p>They all refer back to the same modules, parameterized according to their domain, environment, and quality plus the appropriate VPC and subnet IDs. The difference between them, then, is <em>when</em> changes are&nbsp;deployed.</p>

        </section>

        <footer>
            <p class="fine-print">&copy; 2020-2022 &mdash; Source <span class="fancy">&amp;</span> Binary&nbsp;LLC</p>
        </footer>
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-T1M8F1RWMC"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', 'G-T1M8F1RWMC');
        </script>
    </body>
</html>
