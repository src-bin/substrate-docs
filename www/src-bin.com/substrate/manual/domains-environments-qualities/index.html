<!doctype HTML>
<html lang="en">
<meta charset="utf-8">
<head>
<link href="/css/2019-11-01.css" rel="stylesheet">
<title>Source &amp; Binary / Domains, environments, and qualities</title>
</head>
<body>
<header><h1><a href="/">Source <span class="fancy">&amp;</span> Binary</a></h1></header>

<h1>Domains, environments, and qualities</h1>

<p>Substrate leans heavily on three concepts in order to improve the reliability of the overall system by minimizing the blast radius of changes.</p>

<p>They&rsquo;re usually referred to in alphabetical order - domain, environment, and quality - but are presented here in a progression more suitable to readers new to Substrate.</p>

<h2>Environments</h2>

<p>Environments identify a set of data and the infrastructure that stores and processes it. (After all, what distinguishes your production environment from development, staging, or another? Production <em>data</em>; your customers&rsquo; <em>real, business-critical data</em>.) An environment&rsquo;s primary purpose is to protect its data against access from other environments.</p>

<p>Use multiple environments to protect your customers’ data from code that hasn’t been tested thoroughly in pre-production environments.</p>

<p>An AWS account in your organization is a member of exactly one environment and can only access the networks assigned to that environment.</p>

<h3>Example</h3>

<p>Organizations typically define environments like <em>development</em>, <em>staging</em>, and <em>production</em> though the names and number is entirely up to them. Add more environments to support more different kinds of testing with greater parallelism.</p>

<h2>Qualities</h2>

<p>Highly reliable services almost always implement changes gradually to give their operators a chance to detect and mitigate failures when the impact is small. Qualities help make gradual change possible for many AWS resources like load balancers and security groups, even within a single service.</p>

<p>Use multiple qualities to protect any one service from changes that affect that whole service immediately.</p>

<p>An AWS account in your organization is associated with exactly one quality but can access and use resources in any AWS account that shares its environment.</p>

<h3>Example</h3>

<p>Suppose your organization defined the qualities <em>alpha</em>, <em>beta</em>, and <em>gamma</em> (which is one set of qualities that Substrate recommends). You could run 1% of your production environment in your alpha accounts, 9% in your beta accounts, and the remaining 90% in your gamma accounts. This isn&rsquo;t as smooth as routing a slowly increasing percentage of traffic to your new software as it&rsquo;s being deployed (and you should strongly consider doing that, too) but this strategy works even for AWS resources like load balancers and security groups.</p>

<p>You could also decide to name your qualities <em>blue</em> and <em>green</em> and swing traffic back and forth between them. The slight disadvantage to this architecture is that the one that&rsquo;s not receiving any traffic is not, at that moment, proving that its configuration is functional and thus the first trickle of traffic that comes to it when you start to swing back to it is slightly higher risk.</p>

<p>You could also decide to name your only quality <em>default</em>. Later, when you need it, you can add a <em>canary</em> quality that your deploy to first and that takes a small fraction of your traffic. You might also add an <em>enterprise</em> or <em>proven</em> quality that you deploy to last where your highest-paying or most-risk-averse customers are routed.</p>

<h2>Domains</h2>

<p>Domains are collections of one or more software services that form an isolated failure domain (pun very much intended). The software may be that which you&rsquo;ve written yourself, hosted in any serverless or serverful manner, or an AWS-managed service.</p>

<p>Use multiple domains to protect services in any one domain from changes in all other domains. </p>

<p>An AWS account in your organization is associated with exactly one domain but can access and use resources in any AWS account that shares its environment. There may be multiple AWS accounts within a domain, each of a different quality.</p>

<h3>Example</h3>

<p>It is intended that every AWS account that shares the same domain also shares the same Terraform codebase. That codebase progresses through environments and qualities as changes are deployed. For example, consider the domain <em>example</em> which exists in the following environments and qualities:</p>

<ul>
<li>Domain: <em>example</em>, Environment: <em>staging</em>, Quality: <em>alpha</em></li>
<li>Domain: <em>example</em>, Environment: <em>production</em>, Quality: <em>beta</em></li>
<li>Domain: <em>example</em>, Environment: <em>production</em>, Quality: <em>gamma</em></li>
</ul>

<p>They all refer back to the same modules, parameterized according to their domain, environment, and quality plus the appropriate VPC and subnet IDs. The difference between them, then, is <em>when</em> changes are deployed.</p>

<p>Because domains are made out of AWS accounts, and because AWS accounts are notoriously awkward to delete, you should try to create domains that you believe will be (nearly) permanent. Thus, consider naming them after stable architectural or business units not e.g. speculative skunkworks projects.</p>

<footer>
<ul>
<li><a href="/services/">Services</a>: <small>infrastructure, architecture, compliance</small></li>
<li><a href="/substrate/">Substrate</a>, <small>my suite of AWS management tools</small></li>
</ul>
<p>Copyright &copy; 2020-2021 &mdash; Source <span class="fancy">&amp;</span> Binary LLC</p>
</footer>
</body>
</html>
